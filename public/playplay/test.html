<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chargement dynamique de WASM avec ES6 Modules</title>
</head>
<body>
    <h1>Chargement dynamique de WebAssembly avec Emscripten (ES6)</h1>
    <button id="loadBtn">Charger et exécuter le module WASM</button>
    <p>Vérifiez la console pour les résultats.</p>

    <script type="module">
        async function loadWasm() {
            const module = await import('/public/playplay/playplaymodule.js');
            const instance = await module.default();

            const fileId = new Uint8Array([0x1a, 0x2b, 0x3c, 0x4d, 0x5e, 0x6f, 0x70, 0x81, 0x92, 0xa3, 0xb4, 0xc5, 0xd6, 0xe7, 0xf8, 0x09, 0x10, 0x11, 0x12, 0x13]);
            const obfuscatedKey = new Uint8Array([0x9f, 0x8e, 0x7d, 0x6c, 0x5b, 0x4a, 0x39, 0x28, 0x17, 0x16, 0x25, 0x34, 0x43, 0x52, 0x61, 0x70]);

            const fileIdOffset = 0;
            const obfuscatedKeyOffset = 64;

            instance.HEAPU8.set(fileId, fileIdOffset);
            instance.HEAPU8.set(obfuscatedKey, obfuscatedKeyOffset);

            const boundKeyPtr = instance._process_keys(fileIdOffset, obfuscatedKeyOffset);

            const boundKey = new Uint8Array(instance.HEAPU8.buffer, boundKeyPtr, 16);

            console.log("Bound Key:", Array.from(boundKey).map(b => b.toString(16).padStart(2, '0')).join(''));
        }

        // Ajouter un événement au bouton pour charger et exécuter le module dynamiquement
        document.getElementById('loadBtn').addEventListener('click', loadWasm);
    </script>
</body>
</html>
