<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAssembly Example without malloc</title>
    <script>
        async function loadWasm() {
            const { default: PlayPlayModule } = await import('/public/playplay/playplaymodule.js');
            const instance = await PlayPlayModule();


            // Simuler un tableau de file_id et obfuscated_key en entrée
            const fileId = new Uint8Array([0x1a, 0x2b, 0x3c, 0x4d, 0x5e, 0x6f, 0x70, 0x81, 0x92, 0xa3, 0xb4, 0xc5, 0xd6, 0xe7, 0xf8, 0x09, 0x10, 0x11, 0x12, 0x13]);
            const obfuscatedKey = new Uint8Array([0x9f, 0x8e, 0x7d, 0x6c, 0x5b, 0x4a, 0x39, 0x28, 0x17, 0x16, 0x25, 0x34, 0x43, 0x52, 0x61, 0x70]);

            // Copier directement les données dans la mémoire WebAssembly
            instance.HEAPU8.set(fileId, 0);  // Commence à l'adresse 0 pour simplifier
            instance.HEAPU8.set(obfuscatedKey, 32);  // Utilise un autre espace mémoire après 32 octets

            // Appeler la fonction WebAssembly process_keys et récupérer le résultat
            const boundKeyPtr = instance._process_keys(0, 32);  // Pointeurs vers file_id et obfuscated_key

            // Lire le tableau bound_key (16 octets) depuis la mémoire WebAssembly
            const boundKey = new Uint8Array(instance.HEAPU8.buffer, boundKeyPtr, 16);

            // Afficher le résultat
            console.log("Bound Key:", Array.from(boundKey).map(b => b.toString(16).padStart(2, '0')).join(''));
        }

        // Charger et exécuter le module Emscripten
        window.onload = loadWasm;
    </script>
</head>
<body>
    <h1>WebAssembly Example without malloc</h1>
    <p>Check the console for output.</p>
</body>
</html>
